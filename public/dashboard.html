<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Ncoin Dashboard</title>
</head>
<body>
<h2 id="user"></h2>
<p>残高: <span id="balance"></span> Ncoin</p>
<button onclick="claimQuest()">クエスト報酬受け取り</button>
<ul id="history"></ul>

<script>
async function loadDashboard() {
  const res = await fetch('/dashboard');
  const data = await res.json();
  if (!data.success) location.href = '/';
  document.getElementById('user').innerText = 'ようこそ ' + (data.user ? 'ユーザー' : '');
  document.getElementById('balance').innerText = data.user.balance;
  const history = document.getElementById('history');
  history.innerHTML = '';
  data.user.history.forEach(h => {
    const li = document.createElement('li');
    li.textContent = `${h.date}: ${h.type} ${h.amount} Ncoin`;
    history.appendChild(li);
  });
}

async function claimQuest() {
  const res = await fetch('/quest-reward', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ questId: 1, reward: 500 })
  });
  const data = await res.json();
  alert(data.success ? `報酬 ${data.amount} Ncoin 取得！` : `失敗: ${data.reason}`);
  loadDashboard();
}

loadDashboard();
</script>
</body>
</html>
