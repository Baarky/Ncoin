<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Ncoin Dashboard</title>
</head>
<body>
<h2>送金</h2>
<label>送金先 ID:</label>
<input type="text" id="toId"><br>
<label>金額:</label>
<input type="number" id="amount" value="100"><br>
<button id="sendBtn">送金</button>

<script>
// QRコードURLから toId を取得
const params = new URLSearchParams(window.location.search);
const qrToId = params.get("to");
if (qrToId) document.getElementById("toId").value = qrToId;

document.getElementById("sendBtn").addEventListener("click", async () => {
  const fromId = localStorage.getItem("anonId");
  const toId = document.getElementById("toId").value.trim();
  const amount = parseInt(document.getElementById("amount").value, 10);

  if (!fromId) return alert("ログインしてください");
  if (!toId) return alert("送金先IDを入力してください");
  if (!amount || amount <= 0) return alert("正しい金額を入力してください");

  console.log("送信内容:", { fromId, toId, amount });

  const res = await fetch("/api/send", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ fromId, toId, amount })
  });

  const data = await res.json();
  if (data.success) {
    alert("送金成功！");
  } else {
    alert("送金失敗: " + (data.error || "不明なエラー"));
  }
});
</script>
</body>
</html>
